---
- name: kubeconfig files
  template:
    src: etc/{{ item }}.config.j2
    dest: /etc/kubernetes/{{ item }}.config
  with_items:
    - admin
    - controller-manager
    - scheduler

- name: kubelet manifests
  template:
    src: etc/manifests/{{ item }}.yml
    dest: "{{ kube_config_dir }}/manifests/{{ item }}.yml"
  with_items:
    - etcd
    - kube-apiserver
    - kube-controller-manager
    - kube-scheduler

- include_tasks: certs.yml

# wait for core service ports to come up (apiserver, controller-manager, scheduler, etc.)

- name: flannel networking deployment file
  template:
    src: etc/net/flannel.yml
    dest: "{{ kube_config_dir }}/net/flannel.yml"

- name: core-dns deployment file
  template:
    src: etc/net/core-dns.yml
    dest: "{{ kube_config_dir }}/net/core-dns.yml"

- name: kube-dashboard file
  template:
    src: kube-dashboard.yml
    dest: "{{ kube_config_dir }}/kube-dashboard.yml"

- name: token auth file
  template:
    src: token-auth.csv
    dest: "{{ kube_config_dir }}/pki/token-auth.csv"

# use ansible kube module to put kube-flannel in place
# or use weave networking file

# kube-dns or OpenDNS for service discovery

# kubelet service

# kube-proxy service